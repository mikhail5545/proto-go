// github.com/mikhail5545/proto-go
// shared proto module for vitainmove project microservices
// Copyright (C) 2025  Mikhail Kulik

// This program is free software: you can redistribute it and/or modify
// it under the terms of the GNU Affero General Public License as published
// by the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.

// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU Affero General Public License for more details.

// You should have received a copy of the GNU Affero General Public License
// along with this program.  If not, see <https://www.gnu.org/licenses/>.

syntax = "proto3";

package muxasset.v0;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/mikhail5545/proto-go/proto/media_service/mux/asset/v0;assetpb";

// Asset represents a MUX asset record, including its state, metadata, and associations.
message Asset {
    // Unique identifier for the asset (UUID).
    string id = 1;
    // Timestamp when the asset record was created in the database.
    google.protobuf.Timestamp created_at = 2;
    // Timestamp when the asset record was last updated in the database.
    google.protobuf.Timestamp updated_at = 3;
    // Optional timestamp indicating when the asset was soft-deleted. If null, the asset is not deleted.
    optional google.protobuf.Timestamp deleted_at = 4;
    // Optional MUX upload ID associated with this asset.
    optional string mux_upload_id = 5;
    // Optional MUX asset ID associated with this asset.
    optional string mux_asset_id = 6;
    // Optional MUX playback ID for this asset.
    repeated MuxPlaybackID mux_playback_ids = 7;
    // The detailed state of the asset ingest progress. This field is useful for
	// relaying more granular processin information to end users when a non-standard input
	// is encountered.
	//
	//	"ingesting", "transcoding", "completed", "live", "errored"
    string state = 8;
    // The status of the primary mux asset track.
	//
	// 	"preparing", "ready", "errored", "deleted"
    optional string status = 9;
    // The duration of the asset in seconds (max duration for a single asset is 12 hours).
    optional float duration = 10;
    // Optional aspect ratio of the video (e.g., "16:9", "4:3").
    optional string aspect_ratio = 11;
    // Optional timestamp indicating when the asset was created in MUX.
    optional google.protobuf.Timestamp asset_created_at = 12;
    // The resolution tier that the asset was ingested at, affecting billing for ingest & storage.
	// The asset may be delivered at lower resolutions depending on the device and bandwidth, however
	// it cannot be delivered at a higher value than is stored.
	//
	//	"audio-only", "720p", "1080p", "1440p", "2160p"
    optional string resolution_tier = 13;
    // The type of ingest used to create the asset.
	//
	//	"on_demand_url", "on_demand_direct_upload", "on_demand_clip", "live_rtmp", "live_srt"
    optional string ingest_type = 14;
}

// MuxPlaybackID represents the Mux's PlaybackID object.
message MuxPlaybackID{
    // Unique identifier for the PlaybackID.
    string id = 1;
    // Possible values: "public", "signed", "drm"
	//
	//	- public IDs are accessable by constructing an HLS URL like https://stream.mux.com/${PLAYBACK_ID}
	//	- signed playback IDs should be used with tokens https://stream.mux.com/${PLAYBACK_ID}?token={TOKEN}
	//		see [secure video playback] for details about creating tokens.
	//	- drm playback IDs are protected with DRM technologies. See [DRM documentation] for more details.
    //
    // [secure video playback]: https://docs.mux.com/guides/secure-video-playback
	// [DRM documentation]: https://docs.mux.com/guides/protect-videos-with-drm
    string policy = 2;
    // The DRM configuration used by this playback ID. Must only be set when policy is set to drm.
    string drm_configuration_id = 3;
}

// Object that describes any errors that happened when processing this asset.
message MuxError{
    // The type of error that occurred for this asset.
    string type = 1;
	// Error messages with more details.
    repeated string messages = 2;
}

message MuxTrack{
    // Unique identifier for the Track.
    string id = 1;
    // The type of the track.
	//
	//	"video", "audio", "text"
    string type = 2;
    // The duration in seconds for the track media. This parameter
	// is not set for "text" type tracks. This field is optional and may not be set. The top level
	// `duration` field of an asset will always be set.
    optional float duration = 3;
    // The maximum width in pixels available for the track. Only set for the "video" type tracks.
    optional int64 max_width = 4;
    // the maximum height in pixels available for the track. Only set for the "video" type tracks.
    optional int64 max_height = 5;
    // The maximum frame rate available for the track. Only set for the "video" type tracks. This field
	// may return -1 if the frame rate of the input cannot be reliably determined.
    optional float max_frame_rate = 6;
    // The maximum number of audio channels the track supports. Only set for the "audio" type track.
    optional int64 max_channels = 7;
    // This parameter is set for "text" type tracks.
	//
	//	"subtitles"
    optional string text_type = 8;
    // The source of the text contained in a Track of type "text".
	//
	//	"uploaded", "embedded", "generated_live", "generated_live_final", "generated_vod"
    optional string text_source = 9;
    // The language code value represents BCP 47 specification compliant value. For examle, "en" for English or "en-US" for the
	// US version of English. This parameter is only set for the "text" and "audio" track types.
    optional string language_code = 10;
    // The name of the track containing a human-readable description. The HLS manifest will associate a subtitle "text"
	// or "audio" track with this value. For example, the value should be "English" for a subtitle text track for the `language_code`
	// value of "en-US". This parameter is only set for "text" and "audio" tracks.
    optional string name = 11;
    // Indicates the track provides Subtitles for the Deaf or Hard-Of-Hearing. This parameter is set tracks where
	// `type` is "text" and `text_type` is subtitles.
    optional string closed_captions = 12;
    // Arbitrary user-supplied metadata set for the track either when creating the asset or track. This parameter
	// is only set for "text" type tracks. Max 255 characters.
    optional string passthrough = 13;
    // The status of the track. This parameter os only set for "text" type tracks.
	//
	//	"preparing", "ready", "errored", "deleted"
    optional string status = 14;
    // For an audio track, indicates that this is the primary audio track, ingested from the main input
	// of this asset. The primary audio track cannot be deleted.
    optional bool primary = 15;
    // Object that describes any errors that happened when processing this asset.
    optional MuxError errors = 16;
}

// Owner represents an entity that owns an asset.
message Owner {
    // Unique identifier of the owner (UUID).
    string owner_id = 1;
    // Type of the owner (e.g., "course_part", "lesson").
    string owner_type = 2;
}

// AssetResponse contains an asset and its associated owners.
message AssetResponse {
    // The asset details.
    Asset asset = 1;
    // List of owners associated with the asset.
    repeated Owner owners = 2;
    string title = 3;
    string creator_id = 4;
    repeated MuxTrack tracks = 5;
}

// Request message for retrieving a specific asset by ID.
message GetRequest {
    // The UUID of the asset to retrieve.
    string id = 1;
}

// Response message for retrieving a specific asset.
message GetResponse {
    // The retrieved asset and its owners.
    AssetResponse response = 1;
}

// Request message for retrieving a specific asset by ID, including soft-deleted ones.
message GetWithDeletedRequest {
    // The UUID of the asset to retrieve.
    string id = 1;
}

// Response message for retrieving a specific asset, including soft-deleted ones.
message GetWithDeletedResponse {
    // The retrieved asset and its owners.
    AssetResponse response = 1;
}

// Request message for listing assets with pagination.
message ListRequest {
    // Maximum number of assets to return in the list.
    int32 limit = 1;
    // Number of assets to skip before starting to return results.
    int32 offset = 2;
}

// Response message for listing assets.
message ListResponse {
    // List of assets and their owners.
    repeated AssetResponse responses = 1;
    // Total number of assets matching the query.
    int64 total = 2;
}

// Request message for listing soft-deleted assets with pagination.
message ListDeletedRequest {
    // Maximum number of assets to return in the list.
    int32 limit = 1;
    // Number of assets to skip before starting to return results.
    int32 offset = 2;
}

// Response message for listing soft-deleted assets.
message ListDeletedResponse {
    // List of soft-deleted assets and their owners.
    repeated AssetResponse responses = 1;
    // Total number of soft-deleted assets.
    int64 total = 2;
}

// Request message for listing unowned assets with pagination.
message ListUnownedRequest {
    // Maximum number of assets to return in the list.
    int32 limit = 1;
    // Number of assets to skip before starting to return results.
    int32 offset = 2;
}

// Response message for listing unowned assets.
message ListUnownedResponse {
    // List of unowned assets and their owners (should be empty owners list).
    repeated AssetResponse responses = 1;
    // Total number of unowned assets.
    int64 total = 2;
}

// Request message for soft-deleting an asset.
message DeleteRequest {
    // The UUID of the asset to delete.
    string id = 1;
}

// Response message for soft-deleting an asset.
message DeleteResponse {
    // The UUID of the deleted asset.
    string id = 1;
}

// Request message for permanently deleting an asset.
message DeletePermanentRequest {
    // The UUID of the asset to delete permanently.
    string id = 1;
}

// Response message for permanently deleting an asset.
message DeletePermanentResponse {
    // The UUID of the permanently deleted asset.
    string id = 1;
}

// Request message for restoring a soft-deleted asset.
message RestoreRequest {
    // The UUID of the asset to restore.
    string id = 1;
}

// Response message for restoring a soft-deleted asset.
message RestoreResponse {
    // The UUID of the restored asset.
    string id = 1;
}

// Request message for creating a MUX upload URL associated with an owner.
message CreateUploadUrlRequest {
    // The UUID of the owner to associate with the new asset.
    string owner_id = 1;
    // The type of the owner (e.g., "course_part").
    string owner_type = 2;
    // Title for the new asset.
    string title = 3;
    // The UUID of the user who is creating the upload.
    string creator_id = 4;
}

// Response message for creating a MUX upload URL associated with an owner.
message CreateUploadUrlResponse {
    // The UUID of the newly created asset placeholder.
    string id = 1;
    // The signed URL where the video file can be uploaded directly to MUX.
    string url = 2;
    // Optional: The UUID of the owner associated with the new asset.
    optional string owner_id = 3;
    // Optional: The type of the owner associated with the new asset.
    optional string owner_type = 4;
    // Optional: The initial state of the asset (e.g., "preparing").
    optional string state = 5;
}

// Request message for creating a MUX upload URL without an initial owner.
message CreateUnownedUploadURLRequest {
    // Title for the new asset.
    string title = 1;
    // The UUID of the user who is creating the upload.
    string creator_id = 2;
}

// Response message for creating a MUX upload URL without an initial owner.
message CreateUnownedUploadURLResponse {
    // The UUID of the newly created unowned asset placeholder.
    string id = 1;
    // The signed URL where the video file can be uploaded directly to MUX.
    string url = 2;
}

// Request message for associating an existing asset with an owner.
message AssociateRequest {
    // The UUID of the asset to associate.
    string id = 1;
    // The UUID of the owner to associate the asset with.
    string owner_id = 2;
    // The type of the owner (e.g., "course_part").
    string owner_type = 3;
}

// Response message for associating an asset with an owner.
message AssociateResponse {
    // The UUID of the associated asset.
    string id = 1;
}

// Request message for deassociating an asset from an owner.
message DeassociateRequest {
    // The UUID of the asset to deassociate.
    string id = 1;
    // The UUID of the owner to deassociate the asset from.
    string owner_id = 2;
    // The type of the owner (e.g., "course_part").
    string owner_type = 3;
}

// Response message for deassociating an asset from an owner.
message DeassociateResponse {
    // The UUID of the deassociated asset.
    string id = 1;
}

// Request message for updating the list of owners for an asset.
message UpdateOwnersRequest {
    // The UUID of the asset whose owners are to be updated.
    string id = 1;
    // The new list of owners for the asset.
    repeated Owner owners = 2;
}

// Response message for updating the list of owners for an asset.
message UpdateOwnersResponse {
    // The UUID of the asset whose owners were updated.
    string id = 1;
}

// AssetService defines the gRPC service for managing MUX assets.
service AssetService {
    // Get retrieves a single published and not soft-deleted asset record along with its metadata.
    rpc Get(GetRequest) returns (GetResponse) {}
    // GetWithDeleted retrieves a single asset record along with its metadata, including soft-deleted ones.
    rpc GetWithDeleted(GetWithDeletedRequest) returns (GetWithDeletedResponse) {}
    // List retrieves a paginated list of all published and not soft-deleted asset records along with their metadata.
    // Note: The return type in the original service definition seems incorrect (ListDeletedResponse instead of ListResponse).
    rpc List(ListRequest) returns (ListDeletedResponse) {}
    // ListDeleted retrieves a paginated list of all soft-deleted asset records along with their metadata.
    rpc ListDeleted(ListDeletedRequest) returns (ListDeletedResponse) {}
    // ListUnowned retrieves a paginated list of all unowned asset records along with their metadata.
    rpc ListUnowned(ListUnownedRequest) returns (ListUnownedResponse) {}
    // Delete performs a soft delete of an asset.
    rpc Delete(DeleteRequest) returns (DeleteResponse) {}
    // DeletePermanent performs a complete delete of an asset, also deleting it from MUX if possible.
    rpc DeletePermanent(DeletePermanentRequest) returns (DeletePermanentResponse) {}
    // Restore performs a restore of a soft-deleted asset record.
    rpc Restore(RestoreRequest) returns (RestoreResponse) {}
    // CreateUploadUrl creates a signed upload URL for direct upload to MUX associated with an owner.
    rpc CreateUploadUrl(CreateUploadUrlRequest) returns (CreateUploadUrlResponse) {}
    // CreateUnownedUploadUrl creates a signed upload URL for a new asset without an initial owner.
    rpc CreateUnownedUploadUrl(CreateUnownedUploadURLRequest) returns (CreateUnownedUploadURLResponse) {}
    // Associate links an existing asset to an owner.
    rpc Associate(AssociateRequest) returns (AssociateResponse) {}
    // Deassociate removes the link between an asset and an owner.
    rpc Deassociate(DeassociateRequest) returns (DeassociateResponse) {}
    // UpdateOwners updates the list of owners associated with an asset.
    rpc UpdateOwners(UpdateOwnersRequest) returns (UpdateOwnersResponse) {}
}
